<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>oscl_file_io.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; </center>
<hr><h1>oscl_file_io.h</h1><a href="oscl__file__io_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">// -*- c++ -*-</span>
00002 <span class="comment">// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =</span>
00003 
00004 <span class="comment">//                     O S C L _ F I L E  _ I O</span>
00005 
00006 <span class="comment">// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =</span>
00007 
00021 <span class="preprocessor">#ifndef OSCL_FILE_IO_H_INCLUDED</span>
00022 <span class="preprocessor"></span><span class="preprocessor">#define OSCL_FILE_IO_H_INCLUDED</span>
00023 <span class="preprocessor"></span>
00024 <span class="preprocessor">#ifndef OSCLCONFIG_IO_H_INCLUDED</span>
00025 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="osclconfig__io_8h.html">osclconfig_io.h</a>"</span>
00026 <span class="preprocessor">#endif</span>
00027 <span class="preprocessor"></span>
00028 <span class="preprocessor">#ifndef OSCL_BASE_H_INCLUDED</span>
00029 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="oscl__base_8h.html">oscl_base.h</a>"</span>
00030 <span class="preprocessor">#endif</span>
00031 <span class="preprocessor"></span>
00032 <span class="preprocessor">#ifndef OSCL_MEM_H_INCLUDED</span>
00033 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="oscl__mem_8h.html">oscl_mem.h</a>"</span>
00034 <span class="preprocessor">#endif</span>
00035 <span class="preprocessor"></span>
00036 <span class="preprocessor">#ifndef OSCL_VECTOR_H_INCLUDED</span>
00037 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="oscl__vector_8h.html">oscl_vector.h</a>"</span>
00038 <span class="preprocessor">#endif</span>
00039 <span class="preprocessor"></span>
00047 <span class="keyword">class </span><a class="code" href="classPVLogger.html">PVLogger</a>;
00048 <span class="keyword">class </span><a class="code" href="classOsclFileCache.html">OsclFileCache</a>;
00049 <span class="keyword">class </span><a class="code" href="classOsclFileCacheBuffer.html">OsclFileCacheBuffer</a>;
00050 <span class="keyword">class </span><a class="code" href="classOscl__FileServer.html">Oscl_FileServer</a>;
00051 <span class="keyword">class </span><a class="code" href="classOsclFileHandle.html">OsclFileHandle</a>;
00052 <span class="keyword">class </span><a class="code" href="classOsclNativeFile.html">OsclNativeFile</a>;
00053 <span class="keyword">class </span><a class="code" href="classOsclFileStats.html">OsclFileStats</a>;
00054 <span class="keyword">class </span><a class="code" href="classOsclNativeFileParams.html">OsclNativeFileParams</a>;
00055 <span class="keyword">class </span><a class="code" href="classOsclAsyncFile.html">OsclAsyncFile</a>;
<a name="l00056"></a><a class="code" href="group__osclio.html#a18">00056</a> <span class="preprocessor">#define TOsclFileOffsetInt32 int32</span>
00057 <span class="preprocessor"></span>
<a name="l00058"></a><a class="code" href="classOscl__File.html">00058</a> <span class="keyword">class </span><a class="code" href="classOscl__File.html">Oscl_File</a> : <span class="keyword">public</span> <a class="code" href="classHeapBase.html">HeapBase</a>
00059 {
00060     <span class="keyword">public</span>:
00061 
<a name="l00062"></a><a class="code" href="classOscl__File.html#s11">00062</a>         <span class="keyword">typedef</span> <span class="keyword">enum</span>
00063         {
00067             <a class="code" href="classOscl__File.html#s11s0">SEEKSET</a>,
00071             <a class="code" href="classOscl__File.html#s11s1">SEEKCUR</a>,
00075             <a class="code" href="classOscl__File.html#s11s2">SEEKEND</a>
00076         } <a class="code" href="classOscl__File.html#s11">seek_type</a>;
00077 
<a name="l00078"></a><a class="code" href="classOscl__File.html#s12">00078</a>         <span class="keyword">typedef</span> <span class="keyword">enum</span>
00079         {
00083             <a class="code" href="classOscl__File.html#s12s3">MODE_READ</a> =      0x0001,
00089             <a class="code" href="classOscl__File.html#s12s4">MODE_READWRITE</a> = 0x0002,
00096             <a class="code" href="classOscl__File.html#s12s5">MODE_APPEND</a> =    0x0004,
00100             <a class="code" href="classOscl__File.html#s12s6">MODE_BINARY</a> =    0x0008,
00104             <a class="code" href="classOscl__File.html#s12s7">MODE_TEXT</a> =      0x0010,
00109             <a class="code" href="classOscl__File.html#s12s8">MODE_READ_PLUS</a> =  0x0020
00110 
00111         } <a class="code" href="classOscl__File.html#s12">mode_type</a>;
00112 
00116         OSCL_IMPORT_REF <a class="code" href="classOscl__File.html#a0">Oscl_File</a>();
00117 
00123         OSCL_IMPORT_REF <a class="code" href="classOscl__File.html#a0">Oscl_File</a>(uint32 aCacheSize);
00130         OSCL_IMPORT_REF <a class="code" href="classOscl__File.html#a0">Oscl_File</a>(uint32 aCacheSize, <a class="code" href="classOsclFileHandle.html">OsclFileHandle</a>* aFileHandle);
00131 
00135         OSCL_IMPORT_REF <a class="code" href="classOscl__File.html#a3">~Oscl_File</a>();
00136 
00146         OSCL_IMPORT_REF <span class="keywordtype">void</span> <a class="code" href="classOscl__File.html#a4">SetPVCacheSize</a>(uint32 aSize);
00147 
<a name="l00151"></a><a class="code" href="classOscl__File_1_1OsclFixedCacheParam.html">00151</a>         <span class="keyword">class </span><a class="code" href="classOscl__File_1_1OsclFixedCacheParam.html">OsclFixedCacheParam</a>
00152         {
00153             <span class="keyword">public</span>:
00154                 <span class="comment">/*</span>
00155 <span class="comment">                ** File position where the fixed cache is located.</span>
00156 <span class="comment">                */</span>
<a name="l00157"></a><a class="code" href="classOscl__File_1_1OsclFixedCacheParam.html#m0">00157</a>                 <a class="code" href="osclconfig__io_8h.html#a50">TOsclFileOffset</a> <a class="code" href="classOscl__File_1_1OsclFixedCacheParam.html#m0">iFilePosition</a>;
00158                 <span class="comment">/*</span>
00159 <span class="comment">                ** Fixed cache size in bytes.</span>
00160 <span class="comment">                */</span>
<a name="l00161"></a><a class="code" href="classOscl__File_1_1OsclFixedCacheParam.html#m1">00161</a>                 uint32 <a class="code" href="classOscl__File_1_1OsclFixedCacheParam.html#m1">iSize</a>;
00162 
<a name="l00163"></a><a class="code" href="classOscl__File_1_1OsclFixedCacheParam.html#a0">00163</a>                 <span class="keywordtype">bool</span> <a class="code" href="classOscl__File_1_1OsclFixedCacheParam.html#a0">Contains</a>(<a class="code" href="osclconfig__io_8h.html#a50">TOsclFileOffset</a> pos)<span class="keyword"> const</span>
00164 <span class="keyword">                </span>{
00165                     <span class="keywordflow">return</span> (<a class="code" href="classOscl__File_1_1OsclFixedCacheParam.html#m0">iFilePosition</a> &lt;= pos &amp;&amp; pos &lt; <a class="code" href="classOscl__File_1_1OsclFixedCacheParam.html#m0">iFilePosition</a> + (TOsclFileOffset)<a class="code" href="classOscl__File_1_1OsclFixedCacheParam.html#m1">iSize</a>);
00166                 }
00167         };
00168 
<a name="l00176"></a><a class="code" href="classOscl__File.html#a5">00176</a>         <span class="keywordtype">void</span> <a class="code" href="classOscl__File.html#a5">AddFixedCache</a>(<span class="keyword">const</span> <a class="code" href="classOscl__File_1_1OsclFixedCacheParam.html">OsclFixedCacheParam</a>&amp; aParam)
00177         {
00178             iAddFixedCache.<a class="code" href="classOscl__Vector.html#a5">push_back</a>(aParam);
00179         }
00180 
<a name="l00186"></a><a class="code" href="classOscl__File.html#a6">00186</a>         <span class="keywordtype">void</span> <a class="code" href="classOscl__File.html#a6">RemoveFixedCache</a>(<span class="keyword">const</span> <a class="code" href="osclconfig__io_8h.html#a50">TOsclFileOffset</a> &amp;aPos)
00187         {
00188             iRemoveFixedCache.<a class="code" href="classOscl__Vector.html#a5">push_back</a>(aPos);
00189         }
00190 
<a name="l00196"></a><a class="code" href="classOscl__File_1_1OsclCacheObserver.html">00196</a>         <span class="keyword">class </span><a class="code" href="classOscl__File_1_1OsclCacheObserver.html">OsclCacheObserver</a>
00197         {
00198             <span class="keyword">public</span>:
00199                 <span class="keyword">virtual</span> <a class="code" href="classOsclFileCacheBuffer.html">OsclFileCacheBuffer</a>* <a class="code" href="classOscl__File_1_1OsclCacheObserver.html#a0">ChooseCurCache</a>(<a class="code" href="classOsclFileCache.html">OsclFileCache</a>&amp; aContext, <a class="code" href="osclconfig__io_8h.html#a50">TOsclFileOffset</a> aPos) = 0;
00200         };
<a name="l00201"></a><a class="code" href="classOscl__File.html#a7">00201</a>         <span class="keywordtype">void</span> <a class="code" href="classOscl__File.html#a7">SetCacheObserver</a>(<a class="code" href="classOscl__File_1_1OsclCacheObserver.html">OsclCacheObserver</a>* aObs)
00202         {
00203             iCacheObserver = aObs;
00204         }
00205 
00216         OSCL_IMPORT_REF <span class="keywordtype">void</span> <a class="code" href="classOscl__File.html#a8">SetNativeAccessMode</a>(uint32 aMode);
00217 
<a name="l00221"></a><a class="code" href="classOscl__File.html#s13">00221</a>         <span class="keyword">enum</span> <a class="code" href="classOscl__File.html#s13">TSymbianAccessMode</a>
00222         {
00223             <a class="code" href="classOscl__File.html#s13s9">ESymbianAccessMode_Rfile</a> = 0
00224             , <a class="code" href="classOscl__File.html#s13s10">ESymbianAccessMode_RfileBuf</a> = 1
00225         };
00226 
00241         OSCL_IMPORT_REF <span class="keywordtype">void</span> <a class="code" href="classOscl__File.html#a9">SetNativeBufferSize</a>(int32 aSize);
00242 
00256         OSCL_IMPORT_REF <span class="keywordtype">void</span> <a class="code" href="classOscl__File.html#a10">SetAsyncReadBufferSize</a>(uint32 aSize);
00257 
00280         OSCL_IMPORT_REF int32 <a class="code" href="classOscl__File.html#a11">SetFileHandle</a>(<a class="code" href="classOsclFileHandle.html">OsclFileHandle</a>* aHandle);
00281 
00295         OSCL_IMPORT_REF int32 <a class="code" href="classOscl__File.html#a12">Open</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename, uint32 mode, <a class="code" href="classOscl__FileServer.html">Oscl_FileServer</a>&amp; fileserv);
00296 
00309         OSCL_IMPORT_REF int32 <a class="code" href="classOscl__File.html#a12">Open</a>(<span class="keyword">const</span> <a class="code" href="group__osclbase.html#a32">oscl_wchar</a> *filename, uint32 mode, <a class="code" href="classOscl__FileServer.html">Oscl_FileServer</a>&amp; fileserv);
00310 
00327         OSCL_IMPORT_REF uint32 <a class="code" href="classOscl__File.html#a14">Read</a>(<a class="code" href="group__osclbase.html#a25">OsclAny</a> *buffer,
00328                                     uint32 size,
00329                                     uint32 numelements);
00330 
00342         OSCL_IMPORT_REF uint32 <a class="code" href="classOscl__File.html#a15">Write</a>(<span class="keyword">const</span> <a class="code" href="group__osclbase.html#a25">OsclAny</a> *buffer,
00343                                      uint32 size,
00344                                      uint32 numelements);
00345 
00346 
00356         OSCL_IMPORT_REF int32 <a class="code" href="classOscl__File.html#a16">Seek</a>(<a class="code" href="osclconfig__io_8h.html#a50">TOsclFileOffset</a> offset,
00357                                    <a class="code" href="classOscl__File.html#s11">seek_type</a> origin);
00358 
00363         OSCL_IMPORT_REF <a class="code" href="osclconfig__io_8h.html#a50">TOsclFileOffset</a> <a class="code" href="classOscl__File.html#a17">Tell</a>();
00364 
00365 
00376         OSCL_IMPORT_REF int32 <a class="code" href="classOscl__File.html#a18">Close</a>();
00377 
00378 
00386         OSCL_IMPORT_REF int32 <a class="code" href="classOscl__File.html#a19">Flush</a>();
00387 
00388 
00396         OSCL_IMPORT_REF int32 <a class="code" href="classOscl__File.html#a20">EndOfFile</a>();
00397 
00398 
00406         OSCL_IMPORT_REF int32 <a class="code" href="classOscl__File.html#a21">GetError</a>();
00407 
<a name="l00413"></a><a class="code" href="classOscl__File.html#a22">00413</a>         <a class="code" href="classOsclFileHandle.html">OsclFileHandle</a>* <a class="code" href="classOscl__File.html#a22">Handle</a>()
00414         {
00415             <span class="keywordflow">return</span> iOpenFileHandle;
00416         }
00417 
00423         OSCL_IMPORT_REF <a class="code" href="osclconfig__io_8h.html#a50">TOsclFileOffset</a> <a class="code" href="classOscl__File.html#a23">Size</a>();
00424 
00433         OSCL_IMPORT_REF <span class="keywordtype">void</span> <a class="code" href="classOscl__File.html#a24">SetLoggingEnable</a>(<span class="keywordtype">bool</span> aEnable);
00434 
00442         OSCL_IMPORT_REF <span class="keywordtype">void</span> <a class="code" href="classOscl__File.html#a25">SetSummaryStatsLoggingEnable</a>(<span class="keywordtype">bool</span> aEnable);
00443 
00444 
00445     <span class="keyword">private</span>:
<a name="l00446"></a><a class="code" href="classOscl__File.html#l0">00446</a>         <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classOsclFileCache.html">OsclFileCache</a>;
<a name="l00447"></a><a class="code" href="classOscl__File.html#l1">00447</a>         <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classOsclFileCacheBuffer.html">OsclFileCacheBuffer</a>;
<a name="l00448"></a><a class="code" href="classOscl__File.html#l2">00448</a>         <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classOscl__File.html#l2">asyncfilereadwrite_test</a>;
<a name="l00449"></a><a class="code" href="classOscl__File.html#l3">00449</a>         <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classOscl__File.html#l3">largeasyncfilereadwrite_test</a>;
<a name="l00450"></a><a class="code" href="classOscl__File.html#l4">00450</a>         <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classOscl__File.html#l4">asyncfilereadcancel_test</a>;
00451 
00452         <span class="keywordtype">void</span> Construct();
00453         <span class="keywordtype">void</span> OldCacheDefaults();
00454         <span class="keywordtype">void</span> OldCacheSelect(uint32);
00455 
00456         <span class="comment">//state info</span>
00457         <span class="keywordtype">bool</span> iIsOpen;
00458 
00459         <span class="comment">//For Logging</span>
00460         <a class="code" href="classPVLogger.html">PVLogger</a>* iLogger;
00461         <a class="code" href="classPVLogger.html">PVLogger</a>* iStatsLogger;
00462         <a class="code" href="classPVLogger.html">PVLogger</a>* iNativeLogger;
00463         <a class="code" href="classPVLogger.html">PVLogger</a>* iAsyncLogger;
00464         <a class="code" href="classOsclFileStats.html">OsclFileStats</a>* iFileStats;
00465         <span class="keywordtype">void</span> CreateFileStats();
00466 
00467         <span class="comment">//External file handle.</span>
00468         <a class="code" href="classOsclFileHandle.html">OsclFileHandle</a>* iOpenFileHandle;
00469 
00470         <span class="comment">//For PV File Cache</span>
00471         uint32 iPVCacheSize;
00472         <a class="code" href="classOsclFileCache.html">OsclFileCache</a>* iFileCache;
00473         <a class="code" href="classOscl__Vector.html">Oscl_Vector&lt;OsclFixedCacheParam, OsclMemAllocator&gt;</a> iAddFixedCache;
00474         <a class="code" href="classOscl__Vector.html">Oscl_Vector&lt;TOsclFileOffset, OsclMemAllocator&gt;</a> iRemoveFixedCache;
00475         <a class="code" href="classOscl__File_1_1OsclCacheObserver.html">OsclCacheObserver</a>* iCacheObserver;
00476 
00477         int32 OpenFileCacheOrAsyncBuffer(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename
00478                                          , <span class="keyword">const</span> <a class="code" href="group__osclbase.html#a32">oscl_wchar</a>* wfilename
00479                                          , uint32 mode
00480                                          , <span class="keyword">const</span> <a class="code" href="classOsclNativeFileParams.html">OsclNativeFileParams</a>&amp; params
00481                                          , <a class="code" href="classOscl__FileServer.html">Oscl_FileServer</a>&amp; fileserv) ;
00482 
00483         <span class="comment">//For native file I/O.</span>
00484         <a class="code" href="classOsclNativeFile.html">OsclNativeFile</a>* iNativeFile;
00485         int32 iNativeBufferSize;
00486         uint32 iNativeAccessMode;
00487 
00488         <span class="comment">//For async read feature</span>
00489         uint32 iAsyncReadBufferSize;
00490         <a class="code" href="classOsclAsyncFile.html">OsclAsyncFile</a>* iAsyncFile;
00491 
00492         <span class="comment">// These are wrappers to call the Native OS File IO calls with</span>
00493         <span class="comment">// stats and logging.</span>
00494 
00495         int32  CallNativeOpen(<span class="keyword">const</span> <a class="code" href="classOsclFileHandle.html">OsclFileHandle</a>&amp;, uint32 mode
00496                               , <span class="keyword">const</span> <a class="code" href="classOsclNativeFileParams.html">OsclNativeFileParams</a>&amp; params
00497                               , <a class="code" href="classOscl__FileServer.html">Oscl_FileServer</a>&amp; fileserv);
00498         int32  CallNativeOpen(<span class="keyword">const</span> <a class="code" href="group__osclbase.html#a32">oscl_wchar</a> *filename, uint32 mode
00499                               , <span class="keyword">const</span> <a class="code" href="classOsclNativeFileParams.html">OsclNativeFileParams</a>&amp; params
00500                               , <a class="code" href="classOscl__FileServer.html">Oscl_FileServer</a>&amp; fileserv);
00501         int32  CallNativeOpen(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename, uint32 mode
00502                               , <span class="keyword">const</span> <a class="code" href="classOsclNativeFileParams.html">OsclNativeFileParams</a>&amp; params
00503                               , <a class="code" href="classOscl__FileServer.html">Oscl_FileServer</a>&amp; fileserv);
00504         uint32 CallNativeRead(<a class="code" href="group__osclbase.html#a25">OsclAny</a> *buffer, uint32 size, uint32 numelements);
00505         uint32 CallNativeWrite(<span class="keyword">const</span> <a class="code" href="group__osclbase.html#a25">OsclAny</a> *buffer, uint32 size, uint32 numelements);
00506         int32  CallNativeSeek(<a class="code" href="osclconfig__io_8h.html#a50">TOsclFileOffset</a> offset, <a class="code" href="classOscl__File.html#s11">Oscl_File::seek_type</a> origin);
00507         <a class="code" href="osclconfig__io_8h.html#a50">TOsclFileOffset</a>  CallNativeTell();
00508         int32  CallNativeFlush();
00509         int32  CallNativeEndOfFile();
00510         <a class="code" href="osclconfig__io_8h.html#a50">TOsclFileOffset</a> CallNativeSize();
00511         int32 CallNativeClose();
00512         uint32 CallNativeMode();
00513         int32 CallNativeGetError();
00514         OSCL_IMPORT_REF uint32 GetAsyncFileNumOfRun();
00515         OSCL_IMPORT_REF uint32 GetAsyncFileNumOfRunError();
00516 
00517 };
00518 
00519 
00520 <span class="comment">//Include all public file apis for convenience here.</span>
00521 <span class="preprocessor">#include "<a class="code" href="oscl__file__server_8h.html">oscl_file_server.h</a>"</span>
00522 <span class="preprocessor">#include "<a class="code" href="oscl__file__find_8h.html">oscl_file_find.h</a>"</span>
00523 <span class="preprocessor">#include "<a class="code" href="oscl__file__dir__utils_8h.html">oscl_file_dir_utils.h</a>"</span>
00524 <span class="preprocessor">#include "<a class="code" href="oscl__file__handle_8h.html">oscl_file_handle.h</a>"</span>
00525 
00526 <span class="preprocessor">#endif // OSCL_FILE_IO_H_INCLUDED</span>
00527 <span class="preprocessor"></span>
</pre></div><hr size="1"><img src="pvlogo_small.jpg"><address style="align: right;"><small>OSCL API</small>
<address style="align: left;"><small>Posting Version: OPENCORE_20090517 </small>
</small></address>
</body>
</html>
